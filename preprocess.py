import joblib
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.decomposition import TruncatedSVD
import spacy
import ru_core_news_sm
import re

base_words = ['сдаться', 'плен', 'пленный', 'военнопленный', "сдача", 'раненый', 'поставка',
              'помощь', 'пво', 'сбить', 'ракета', 'авиация', "уничтожить", "наркотик"]

stopwords = {'поскольку', 'только', 'нас', 'моё', 'каждый', 'ранее', 'нешто', 'которые', 'едва', 'л', 'вокруг', 'неё', 'далеко', 'сразу', 'наша', 'этою', 'едят', 'меня', 'пора', 'своей', 'алло', 'самого', 'вплоть', 'один', 'бишь', 'х', 'нужные', 'ом', 'данном', 'нашими', 'может', 'за', 'своим', 'бываю', 'всю', 'наизнанку', 'прочими', 'теперь', 'нибудь', 'среди', 'короче', 'могли', 'откуда', 'дальше', 'тою','ф', 'но', 'доколь', 'этакий', 'никуда', 'щас', 'какими', 'всякий', 'ешь', 'наши', 'всею', 'немногие', 'своему', 'одних',
'имъ', 'кой', 'сродни', 'него', 'поколь', 'данное', 'наперекор', 'чтоб', 'подобные','снова', 'ежели', 'саму', 'ничем', 'самому', 'что', 'было', 'без', 'эх', 'это', 'иным', 'вроде', 'со', 'у', 'была', 'кабы', 'поприще', 'неоткуда', 'ну', 'подавно', 'никого', 'такому', 'она', 'де', 'мою', 'много','взаправду', 'оно', 'либо', 'паче', 'взаимно', 'всём', 'же','чё', 'мало', 'необходимые', 'б', 'особо', 'тот','посему', 'буду', 'нужная', 'нам', 'й', 'стал', 'вресноту', 'себя', 'ведь', 'зря', 'надо', 'наипаче', 'которыми', 'ку','многому', 'кем', 'общую', 'твоё', 'впрочем', 'который', 'своею', 'суть','которых', 'явных', 'такой', 'эту', 'такою', 'также', 'сызнова','давайте', 'ем', 'эта', 'каким', 'наизворот', 'напротив', 'всячески', 'котором', 'д', 'оттот', 'как', 'другой', 'какого', 'какому', 'своих', 'им', 'куда', 'наверху', 'сей', 'многое', 'вправду', 'особую', 'г', 'совсем','аж', 'покамест', 'весь', 'наших', 'ш', 'этак', 'могите', 'могут', 'так', 'этим', 'данных', 'могу', 'необходимо', 'над', 'насилу', 'обычно', 'казалась', 'му', 'там', 'вовсе', 'чём', 'из', 'сможет', 'оттуда', 'тотчас', 'бывает', 'якобы', 'настоящее', 'ниоткуда', 'такое', 'нём', 'вами', 'каждые' 'моём', 'якоже', 'ваше', 'ах', 'тут', 'этом', 'себе', 'при', 'навряд', 'недавно', 'слишком', 'спустя', 'всякой', 'ша', 'ы', 'даже', 'нем', 'все','нужного', 'будучи', 'чего', 'нашему', 'прежде','твоим', 'рядом', 'али', 'настоящий','явно', 'хотя', 'ком', 'каждое', 'какою', 'могла', 'моги', 'нечему', 'наш', 'накануне', 'ещё', 'нате', 'ай', 'данные','точно','тьфу', 'наиболее', 'внизу','чем','хорошо', 'насчет', 'очень', 'можете', 'свою', 'скорее', 'тогда', 'гораздо', 'казаться', 'нашу', 'свой', 'должна', 'коли', 'ли', 'свое', 'кто', 'отчему', 'пока', 'просто', 'вдали', 'ые', 'таков', 'около', 'и', 'некоторые', 'иногда', 'ваши', 'ел', 'особенно', 'сами', 'всем', 'п', 'помимо', 'её', 'почти', 'моя','ый', 'недалеко','каждая', 'меньше', 'никем', 'мною', 'своём','этому','хоть', 'р', 'сего', 'еле', 'проще', 'такого', 'казались', 'никто', 'через', 'почему', 'стала', 'тебя', 'неужели', 'иметь', 'нашей', 'посреди', 'самых', 'сама', 'коль', 'меж', 'кому', 'вдобавок', 'будьте', 'одни', 'пожалуй', 'хотел', 'такую', 'чьим', 'данный', 'всего', 'свои', 'а', 'сначала', 'собственно', 'настоящая', 'всей',
 'хочу', 'агу', 'сам', 'начала', 'бывали', 'тая', 'потому', 'самый', 'чьих', 'ишь', 'мне', 'посредством', 'отнелиже', 'одну', 'ох', 'всему', 'вот', 'одним', 'экий', 'сперва', 'подобная', 'ему', 'нее', 'например', 'непрерывно', 'каков', 'отсюда', 'прям', 'еще', 'е', 'некем', 'никак', 'вернее', 'больше', 'таком', 'уж', 'наподобие', 'ых', 'этой', 'оттого', 'благодаря', 'можно', 'вниз', 'любое', 'ней', 'можешь', 'нашею', 'особые', 'после', 'ничего', 'ч', 'нами', 'под', 'ау', 'нечто', 'такие', 'ее', 'нужный', 'прочее', 'никогда', 'наперед', 'по', 'стало', 'перед', 'чему', 'м', 'ваша', 'ныне', 'покудова', 'всё', 'ибо','эй', 'для', 'таким', 'этими', 'которое', 'ая', 'безусловно', 'назад', 'быть', 'мое', 'вдруг', 'похожем', 'том', 'любую', 'действительно', 'имеет', 'своя', 'нету', 'конечно', 'твоя', 'некуда','дополнительно', 'чуть', 'спокону', 'однажды', 'этих', 'самим', 'кого', 'даром', 'свыше', 'давно', 'бац', 'лишь', 'везде', 'ваш', 'нужных', 'самой', 'здесь', 'данного','тебе', 'на', 'ту', 'дабы', 'чьё', 'самих', 'возможно', 'та', 'незачем', 'нельзя', 'ближайшие', 'вряд','любом', 'кажется', 'тоже', 'видно', 'той', 'благо', 'отчего', 'которая', 'подобный', 'нипочем','сейчас','ими', 'где', 'любой', 'он', 'потом', 'чтобы', 'вы', 'всегда','многого', 'менее', 'самом', 'хотелось', 'однако', 'сквозь', 'наверняка', 'которой', 'могло', 'то', 'тех', 'ух', 'хотела', 'нынешней', 'про', 'чхать', 'любых', 'раньше', 'нынешнее','ж', 'н', 'з', 'вперекор', 'вне','или','сверх', 'едим', 'близко', 'навыворот',
 'негде', 'более', 'его', 'некто', 'твой', 'будет', 'ниже', 'прочего', 'нужно', 'мой', 'своё', 'бывают', 'часто', 'сие', 'именно', 'некоторая', 'другим', 'необходимым', 'одному', 'прочему', 'ха', 'пор', 'да', 'многом', 'был', 'другое','должно', 'такая', 'ест', 'вполне', 'оба', 'покуда', 'данной', 'своем', 'нечего', 'собой', 'подобного', 'нередко','кстати', 'других', 'своими', 'тому', 'будете', 'до', 'такова','всеми', 'довольно', 'вам', 'вместо', 'напрямую', 'некоторый', 'можем', 'всякого', 'ого','вначале', 'вас', 'всюду', 'нашем', 'зато', 'мог', 'некогда', 'чей', 'имело', 'мы', 'начале', 'них', 'пусть', 'очевидно','были', 'не', 'позже', 'смогут', 'мочь', 'фу', 'тем', 'хе', 'чаще','э', 'стали', 'моею', 'вся', 'долго', 'теми', 'давным', 'их', 'которым', 'се', 'между', 'мои', 'вправе', 'таких', 'я', 'о', 'от', 'ура', 'ой', 'самая','зачем', 'никому', 'потомушта', 'твоих', 'хочешь', 'одном', 'го', 'должный', 'мимо', 'впрямь', 'нигде', 'тобою', 'касательно', 'любая', 'затем', 'низко', 'уже', 'поди', 'того',
'другие', 'вообще', 'вишь', 'поколе', 'другими', 'которому', 'ю', 'нынче', 'которою', 'которую', 'немного', 'имела', 'понеже', 'имел', 'будь', 'включая', 'ею', 'необходимости', 'данному', 'некому', 'сих', 'оп', 'томах', 'ка', 'твои', 'они', 'моими', 'будешь', 'нечем', 'значит','моим', 'эдакий', 'неважно', 'любого','должны', 'об', 'причем', 'ко', 'хуже', 'ща', 'этого', 'одно', 'моем', 'будто', 'иль', 'комья', 'с', 'эдак', 'мол', 'такими', 'пожалуйста', 'далее', 'итак', 'собою', 'казался', 'ую', 'в', 'никакой', 'ним', 'нею','многие', 'моему', 'данная', 'моей', 'ти', 'будем', 'вопреки','вчеред', 'какие', 'нашим', 'самими', 'эти','поэтому', 'щ', 'скоро', 'другая', 'разве', 'всея', 'подобных', 'ела', 'к', 'притом', 'ей', 'кроме', 'какой', 'немногим', 'гав', 'одной', 'некоторых', 'оный', 'увы', 'нашего','следует', 'стать', 'одними', 'оне', 'одна', 'авось', 'хотеть', 'одного', 'вновь', 'сколько', 'опять', 'поелику', 'самое','находиться', 'рано', 'есть', 'отовсюду', 'емъ', 'казалось', 'настоящие', 'поистине', 'моего', 'несколько', 'те', 'иначе', 'нет', 'которого', 'вон', 'одною', 'наше', 'иными', 'всех', 'ты', 'доколе','наоборот', 'подобным', 'во', 'когда', 'своего', 'подобно', 'ничему', 'нынешних', 'тобой', 'мной', 'любыми', 'если', 'должен', 'туда', 'наконец', 'внакладе', 'данунах', 'ага', 'наса', 'ними', 'моих', 'будут', 'бывала', 'бытует', 'само', 'яко', 'эка', 'таки', 'какая', 'ничто', 'бы','ради', 'воистину',
 'этот', 'нему', 'отнелижа', 'дану', 'а',  'або',  'адже',  'аж',  'але',  'алло',  'б',  'багато',  'без',  'безперервно',  'би',  'близько',  'бо', 'був', 'буває', 'буде', 'будемо', 'будете', 'будеш', 'буду', 'будуть', 'будь', 'була', 'були', 'було', 'бути', 'більш', 'більше', 'біля', 'в', 'вам', 'вами', 'вас', 'ваш', 'ваша', 'ваше', 'вашим', 'вашими', 'ваших', 'вашого', 'вашому', 'вашою','вашої', 'вашу',
 'ваші', 'вашій', 'вгору', 'вгорі', 'вдалині', 'весь', 'вже', 'ви', 'вниз', 'внизу', 'вона', 'вони', 'воно', 'восьмий', 'все', 'всею', 'всього', 'всьому', 'всю', 'вся', 'всі', 'всім', 'всіх', 'втім', 'від', 'відсотків', 'він', 'вісім', 'вісімнадцятий', 'вісімнадцять', 'г', 'геть', 'говорив', 'говорить', 'давно', 'далеко', 'далі', 'дарма', 'два', 'двадцятий', 'двадцять', 'дванадцятий','дванадцять', 'двох', 'дві','де',"дев'ятий", "дев'ятнадцятий", "дев'ятнадцять", "дев'ять", 'декілька', 'день', 'десятий', 'десять', 'для', 'дня', 'до', 'добре', 'довго', 'доки', 'досить', 'другий', 'дуже', 'дякую', 'дійсно', 'е', 'ж', 'же', 'з', 'за', 'завжди', 'зазвичай', 'занадто', 'зараз',
 'зате', 'звичайно', 'звідси', 'звідусіль', 'здається', 'значить', 'знову', 'зовсім', 'зі', 'й', 'його', 'йому', 'каже', 'ким', 'кого', 'кожен', 'кожна', 'кожне', 'кожні', 'коли', 'кому', 'краще', 'крім', 'куди', 'кілька','ласка', 'ледве', 'лише', 'м', 'майже', 'мало', 'мати', 'має', 'мене', 'менш', 'менше', 'мені', 'ми', 'мимо', 'мною', 'мого', 'могти', 'може', 'можна', 'можно', 'можуть', 'мою', 'моя', 'моє', 'моєму', 'моєю', 'моєї', 'мої','моїй', 'моїм', 'моїми', 'моїх', 'міг', 'між', 'мій', 'мільйонів', 'на', 'навколо', 'навкруги', 'навіть', 'навіщо', 'нагорі', 'над', 'назад', 'найбільш', 'нам', 'нами', 'нарешті', 'нас', 'наш', 'наша', 'наше', 'нашим', 'нашими', 'наших', 'нашого', 'нашому', 'нашою', 'нашої', 'нашу', 'наші', 'нашій', 'не', 'небагато', 'небудь', 'недалеко', 'немає', 'нерідко', 'нещодавно', 'нею', 'неї', 'нибудь', 'нижче', 'низько', 'ним',
 'ними', 'них', 'ну', 'нього', 'ньому', 'ні', 'ніби', 'ніж', 'ній', 'ніколи', 'нікуди', 'нім', 'нічого','о', 'обидва', 'обоє','один', 'одинадцятий','одинадцять', 'однак', 'одного', 'одній', 'однієї', 'означає','окрім', 'он', 'особливо', 'ось',"п'ятий", "п'ятнадцятий", "п'ятнадцять", "п'ять", 'перед','перший', 'по', 'повинно', 'подів', 'поки', 'пора', 'поруч','посеред', 'потрібно', 'потім','почала', 'початку', 'при', 'про', 'просто', 'проте','проти', 'під','пізніше', 'пір', 'після', 'раз', 'разу', 'рано', 'раніше', 'раптом', 'роки', 'року', 'років', 'році', 'рік', 'сам', 'сама',
 'саме', 'самим', 'самими', 'самих','само', 'самого', 'самому','саму', 'самі', 'самій', 'свого', 'свою', 'своє', 'своєї', 'свої', 'своїй', 'своїх', 'себе', 'сих', 'сказав', 'сказала', 'сказати', 'скрізь', 'скільки', 'собою','собі', 'спасибі', 'спочатку', 'справ', 'став', 'суть', 'сьогодні', 'сьомий', 'сім', 'сімнадцятий', 'сімнадцять', 'т', 'та', 'так', 'така', 'таке', 'такий', 'також', 'такі', 'там', 'твого', 'твою', 'твоя', 'твоє', 'твоєму', 'твоєю', 'твоєї', 'твої', 'твоїй', 'твоїм', 'твоїми','твоїх', 'твій', 'те', 'тебе', 'теж', 'тепер', 'ти', 'тим', 'тими', 'тисяч','тих', 'то', 'тобою', 'тобі', 'того', 'тоді', 'той', 'тому', 'тою', 'треба', 'третій', 'три', 'тринадцятий', 'тринадцять', 'трохи', 'ту', 'туди', 'тут', 'ті', 'тій', 'тільки', 'тім', 'тією', 'тієї', 'у', 'увесь', 'уміти', 'усе', 'усього', 'усьому', 'усю', 'усюди','уся', 'усі','усім', 'усіма', 'усіх',
 'хотіти', 'хоч', 'хоча', 'хочеш', 'хто', 'хіба', 'це', 'цей', 'цим', 'цими', 'цих', 'цього', 'цьому', 'цю', 'ця', 'ці', 'цій', 'цієї', 'час', 'часто', 'частіше', 'часу', 'через', 'четвертий', 'чи', 'чий', 'чийого', 'чийому', 'чим', 'численна', 'численне', 'численний', 'численні', 'чию', 'чия', 'чиє', 'чиєму', 'чиєї', 'чиї', 'чиїй', 'чиїм', 'чиїми', 'чиїх', 'чого', 'чому', 'чотири', 'чотирнадцятий', 'чотирнадцять', 'шостий', 'шістнадцятий', 'шістнадцять', 'шість', 'ще','що', 'щоб', 'щодо', 'щось', 'я', 'як', 'яка', 'який', 'яких', 'якого', 'якої', 'якщо', 'які', 'якій', 'є', 'і','із', 'іноді', 'інша', 'інше', 'інший', 'інших', 'інші', 'їй', 'їм', 'їх', 'її'}
regExp = '[^аА-яЯ]|i'
nlp = spacy.load('ru_core_news_sm')
print('nlp download')

def clean(text): # очистка аргумент строкa - на выходе список слов
    text = text.lower()
    text = re.sub(regExp, ' ', text)
    text = re.sub('\s+', ' ', text)
    text = text.lstrip()
    text= text.rstrip()
    text = " ".join(word for word in text.split() if word not in stopwords)
    text = nlp(text)
    tokens = " ".join(token.lemma_ for token in text)
    return tokens


def load_vectorizer(file):  # загрузка векторов
    vectorizer = joblib.load(file)
    print('vectorizer loaded')
    return vectorizer

def load_decompositor(file): # загрузка сокращения размерностей
    decompositor = joblib.load(file)
    print('decompositor loaded')
    return decompositor

def is_neutral(index_base_words, vec):
    vec = vec.toarray()[0]
    if sum( [vec[i] for i in index_base_words] ) == 0: # если компоненты индикатора равны 0- значит нейтральный класс
        return True
    else:
        return False

def is_drug(index_base_words, vec):
    vec = vec.toarray()[0]
    if vec[794002] != 0:
        return True
    else:
        return False